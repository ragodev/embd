package main

import (
	"flag"
	"fmt"
	"io/ioutil"
	"os"
	"path/filepath"
	"strings"
)

func main() {
	var pkg, name string
	flag.StringVar(&name, "n", "", "(optional) name of the variable to generate (default <filename>)")
	flag.StringVar(&pkg, "p", "main", "name of package for file")
	flag.Parse()
	file := flag.Arg(0)
	s, err := ioutil.ReadFile(file)
	if err != nil {
		panic(err)
	}
	if name == "" {
		_, fn := filepath.Split(file)
		name = strings.Split(fn, ".")[0]
	}
	out, err := os.OpenFile(file+".go", os.O_CREATE|os.O_RDWR, 0666)
	if err != nil {
		panic(err)
	}
	defer out.Close()
	fmt.Fprintln(out, "//generated by embd")
	fmt.Fprintf(out, "package %s\n\n", pkg)
	fmt.Fprintf(out, "const %s = %q", name, strings.TrimSpace(string(s)))
}
